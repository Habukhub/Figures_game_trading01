<!doctype html>
<html lang="th">
<head>
    <meta charset="utf-8" />
    <title>Register</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">

            <a class="navbar-brand" href="HomePage.html">Figure Shop</a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="Login.html">LOGIN</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Regieter.html">REGISTER</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!--<h2>Register</h2>

    <form id="regForm">
        <label>Username: <input id="username" required></label><br>
        <label>Email: <input id="email" type="email" required></label><br>
        <label>Password: <input id="password" type="password" required></label><br>
        <label>Phone: <input id="phone"></label><br>
        <label>-->
    <!--Role:
    <select id="role" required>
        <option value="customer" selected>customer</option>

    </select>-->
    <!--</label><br>
        <button type="submit">Create</button>
    </form>-->

    <!-- Register -->
    <main class="container">
        <div class="row justify-content-center mt-5">
            <div class="col-md-6 col-lg-5">

                <div class="card shadow-sm">
                    <div class="card-body p-4">

                        <h2 class="card-title text-center mb-4">Register</h2>
                        <form id="regForm">
                            <div class="mb-3">
                                <label for="username" class="form-label">Username:</label>
                                <input type="text" class="form-control" id="username" name="username" required>
                            </div>
                            <div class="mb-3">
                                <label for="email" class="form-label">Email:</label>
                                <input type="email" class="form-control" id="email" name="email" required>
                            </div>
                            <div class="mb-3">
                                <label for="password" class="form-label">Password:</label>
                                <input type="password" class="form-control" id="password" name="password" required>
                            </div>
                            <div class="mb-3">
                                <label for="tel" class="form-label">Telephone:</label>
                                <input type="tel" class="form-control" id="tel" name="tel" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-100 mt-3">Register</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <p id="msg"></p>
    <script>
        // ใช้ path แบบ relative จาก /View/Regieter.html
        const API = new URL('../Services/dbService.svc', location.href).href;

        // helper: หาช่องกรอกด้วย id หรือ name
        const $ = (id, name) => document.getElementById(id) || document.querySelector(`[name="${name}"]`);

        document.getElementById('regForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const elUsername = $('username', 'username');
            const elEmail = $('email', 'email');
            const elPassword = $('password', 'password');
            const elPhone = $('phone', 'phone');

            // ถ้า element ไหนไม่มี ให้เตือนทันที
            if (!elUsername || !elEmail || !elPassword) {
                const missing = [
                    !elUsername ? 'username' : null,
                    !elEmail ? 'email' : null,
                    !elPassword ? 'password' : null
                ].filter(Boolean).join(', ');
                alert('ขาดช่อง: ' + missing + ' (ตรวจ id/name ให้ตรง)');
                return;
            }

            const username = (elUsername.value || '').trim();
            const email = (elEmail.value || '').trim();
            const password = elPassword.value || '';
            const phone = elPhone ? (elPhone.value || '').trim() : null;

            if (!username || !email || !password) {
                alert('กรอก Username, Email, Password ให้ครบ');
                return;
            }

            // บังคับทุกคนเป็น customer เสมอ
            const role = 'customer';

            const payload = { username, email, password, phone, role };

            try {
                const res = await fetch(`${API}/users`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const text = (await res.text()).replace(/"/g, '');

                if (!res.ok || text !== 'success') {
                    alert('สมัครไม่สำเร็จ (อาจซ้ำหรือข้อมูลไม่ครบ)');
                    return;
                }

                alert('สมัครสำเร็จ! ไปหน้า Login ได้เลย');
                location.href = 'Login.html';
            } catch (err) {
                console.error(err);
                alert('ติดต่อเซิร์ฟเวอร์ไม่ได้');
            }
        });


    </script>


</body>
</html>
